# Агрегатор новостей для трейдеров

> Проект выполнен в рамках хакатона от Orion Soft под названием **ВНЕДРЕЙД**.

> ⚠️ **Внимание:** Данный репозиторий содержит только часть командного проекта, выполненную мной (data science, парсинг, векторизация, FastAPI). Вся система разрабатывалась в команде, и здесь представлена моя зона ответственности.

## Описание проекта

**Цель:**  
Разработать прототип агрегатора, саммаризатора и интерпретатора новостей для информационно-аналитической поддержки розничных трейдеров на российском фондовом рынке.

**Кратко:**  
Система автоматически собирает новости из проверенных источников, очищает и нормализует текст, векторизует данные и сохраняет их в базу знаний. Далее реализован FastAPI-сервер, который по тексту новости определяет, как она может повлиять на цену (up/down), и возвращает результат в формате JSON.

---

## Функционал

- **Сбор и парсинг новостей** из проверенных источников (например, РБК, Интерфакс).
- **Очистка и нормализация** текстов новостей.
- **Векторизация** новостей (создание эмбеддингов).
- **Сохранение эмбеддингов** в базу данных PostgreSQL.
- **API на FastAPI**:
  - `/score` — принимает текст новости, возвращает, есть ли похожая новость в базе.
  - `/score2` — принимает текст новости, возвращает прогноз влияния на цену (up/down) и score.
- **JSON-ответ** для интеграции с другими сервисами (например, Telegram-ботом).

---

## Архитектура

- **Backend:** Python (FastAPI)
- **NLP:** эмбеддинги через Ollama (`nomic-embed-text`)
- **База данных:** PostgreSQL
- **Деплой:** Docker (рекомендуется)
- **Интеграция:** Telegram Bot API (опционально)

---

## Как это работает

1. **Сбор данных:**  
   Парсер собирает новости, очищает и нормализует текст.
2. **Векторизация:**  
   Для каждой новости считается embedding с помощью Ollama.
3. **Сохранение:**  
   Эмбеддинги и метаданные сохраняются в PostgreSQL.
4. **API:**  
   - `/score` — проверяет, есть ли похожая новость в базе.
   - `/score2` — определяет, как новость повлияет на цену (up/down).

---

## Запуск проекта

### 1. Клонирование репозитория

```bash
git clone https://github.com/MityaiGer/News_aggregator_for_traders.git
cd News_aggregator_for_traders
```

### 2. Создание и активация виртуального окружения

```bash
python3 -m venv venv
source venv/bin/activate
```

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 4. Настройка переменных окружения

Создайте файл `.env` (или пропишите параметры подключения к БД в коде/секретах).

### 5. Запуск FastAPI

```bash
uvicorn FASTAPI.fastapi_score:app --reload
# или
uvicorn FASTAPI.fastapi_score2:app --reload
```

---

## Пример запроса

```bash
curl -X POST "http://localhost:8000/score" -H "Content-Type: application/json" -d '{"text": "Текст новости"}'
```

**Ответ:**
```json
{
  "is_exist": true
}
```

---

## Структура проекта и назначение скриптов

### 1. Парсинг и сбор новостей

- **parse_kommersant_rss_to_article.py**  
  Парсит RSS-ленту раздела "Экономика" с сайта kommersant.ru, извлекает новости, фильтрует по тематике, преобразует дату и сохраняет в таблицу `article` в PostgreSQL.

- **parse_vedomosti_rss_to_article.py**  
  Парсит RSS-ленту раздела "Финансы" с vedomosti.ru, извлекает новости, преобразует дату и сохраняет в таблицу `article`.

- **parse_interfax_rss_to_article.py**  
  Парсит RSS-ленту с interfax.ru, сопоставляет категории новостей с секторами экономики, фильтрует и сохраняет новости в таблицу `article`.

### 2. Векторизация и работа с эмбеддингами

- **vectorize_article_score.py**  
  Для каждой новости из таблицы `article` (где не проставлен score) получает embedding через Ollama, ищет наиболее похожий embedding из базы знаний (`news_scaled`), присваивает score и обновляет запись.


- **db_embedding/create_embedding.py** 
  Обновляет эмбеддинги для всех строк в датасете (CSV), используя Ollama, и сохраняет их в базу данных. Использует прогресс-бар для отслеживания процесса.

### 3. API и интеграция

- **FASTAPI/fastapi_score.py**  
  FastAPI-сервер: принимает текст новости, возвращает, есть ли похожая новость в базе (по косинусному сходству эмбеддингов).

- **FASTAPI/fastapi_score2.py**  
  FastAPI-сервер: принимает текст новости, возвращает прогноз влияния на цену (up/down) и score, а также флаг наличия похожей новости.

- **FASTAPI/Dockerfile**  
  Docker-образ для деплоя FastAPI-сервера.

### 4. Вспомогательные файлы

- **Rus_company.csv**  
  Справочник российских компаний: тикер, название, сектор, индустрия. Используется для сопоставления новостей с компаниями и секторами.

- **merged_and_scaled.csv**  
  Основной датасет новостей: содержит тексты, эмбеддинги, оценки влияния (score) и другую информацию. Используется как база знаний для поиска похожих новостей и предсказания влияния.

---

## Описание датасета

**merged_and_scaled.csv**  
- Содержит новости, собранные с различных источников (Kommersant, Ведомости, Интерфакс и др.).
- Для каждой новости: заголовок, текст, дата, категория/сектор, embedding (векторное представление текста), score (оценка влияния новости на рынок).
- Используется для поиска похожих новостей по embedding и для предсказания влияния новых новостей на котировки.

**Rus_company.csv**  
- Таблица соответствия тикеров, названий компаний, секторов и индустрий.
- Позволяет фильтровать и анализировать новости по компаниям и секторам.

---

## Группировка

- **Парсинг:**  
  parse_kommersant_rss_to_article.py, parse_vedomosti_rss_to_article.py, parse_interfax_rss_to_article.py

- **Векторизация и эмбеддинги:**  
  vectorize_article_score.py, vec.py, emb.py, db_embedding/create_embedding.py

- **API:**  
  FASTAPI/fastapi_score.py, FASTAPI/fastapi_score2.py

- **Датасеты и справочники:**  
  merged_and_scaled.csv, Rus_company.csv

---